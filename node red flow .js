[{"id":"2781e73f.d229f8","type":"rbe","z":"a8fa2fe0.a20248","name":"rbe","func":"rbe","gap":"","start":"","inout":"out","x":236,"y":112,"wires":[["4283d1d.02f82b"]]},{"id":"8d68ad1e.bf6318","type":"trigger","z":"a8fa2fe0.a20248","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","name":"","x":517,"y":173,"wires":[["f5c24c33.77d3f"]]},{"id":"c5c10f3e.70df78","type":"ibmiot in","z":"a8fa2fe0.a20248","authentication":"apiKey","apiKey":"","inputType":"evt","deviceId":"Sensor01","applicationId":"","deviceType":"Sensor","eventType":"iotsensor","commandType":"","format":"json","name":"IBM IoT","service":"registered","allDevices":false,"allApplications":"","allDeviceTypes":"","allEvents":false,"allCommands":"","allFormats":true,"qos":0,"x":120,"y":112,"wires":[["2781e73f.d229f8"]]},{"id":"609ce186.f8cf68","type":"http request","z":"a8fa2fe0.a20248","name":"","method":"POST","ret":"obj","url":"https://ibmnotifybm.mybluemix.net/api/alerts/v1","tls":"","x":725.5,"y":105,"wires":[["a95359ff.76ec"]]},{"id":"a95359ff.76ec","type":"debug","z":"a8fa2fe0.a20248","name":"","active":true,"console":"false","complete":"true","x":861.5,"y":105,"wires":[]},{"id":"4283d1d.02f82b","type":"function","z":"a8fa2fe0.a20248","name":"Temp Threshold","func":"var temp = msg.payload.d.temperature;\nvar device = msg.payload.d.name;\n\nvar upperThreshold = 30;\nvar lowerThreshold = 15;\n\n\nif ( temp > upperThreshold){\n\tmsg.payload = {\"device\": String(device),\"alertmessage\":\"Temperature is too high: \"+Math.round(String(temp))+\" C\",\"severity\":\"Fatal\",\"type\":\"Problem\",\"temp\":String(temp)};\n\tmsg.reset = {\"reset\":0};\n\treturn [msg,msg.reset];\n}\n\nelse if (temp <= upperThreshold && temp >= lowerThreshold){\n msg.payload = {\"device\": String(device),\"alertmessage\":\"Temperature is normal: \"+Math.round(String(temp))+\" C\",\"severity\":\"Clear\",\"type\":\"Resolution\",\"temp\":String(temp)};\n return [null,msg];\n }\n\nelse if ( temp < lowerThreshold){\n msg.payload = {\"device\": String(device),\"alertmessage\":\"Temperature is too low: \"+Math.round(String(temp))+\" C\",\"severity\":\"Fatal\",\"type\":\"Problem\",\"temp\":String(temp)};\n\tmsg.reset = {\"reset\":0};\n\treturn [msg,msg.reset];\n}","outputs":"2","noerr":0,"x":382,"y":112,"wires":[["f5c24c33.77d3f"],["8d68ad1e.bf6318"]]},{"id":"f5c24c33.77d3f","type":"function","z":"a8fa2fe0.a20248","name":"ANS","func":"var locat = \"London\";\nvar alertmessage = msg.payload.alertmessage;\nvar topic = msg.topic;\nvar deviceid = msg.deviceId;\nvar devicetype = msg.deviceType;\nvar sev = msg.payload.severity;\nvar type = msg.payload.type;\nvar temp = msg.payload.temp;\n\nmsg.payload = \n{\n \"Identifier\": String(topic),\n \"What\": \"Temperature Alert (\"+String(temp)+\" °C) @Device: \"+String(deviceid),\n \"Where\": String(locat),\n \"Severity\": String(sev),\n \"Type\": String(type),\n \"Source\": String(deviceid),\n \"ApplicationsOrServices\": [\n String(topic)\n ],\n /*\"URLs\": [\n {\n \"Description\": \"\",\n \"URL\": \"\"\n }\n ],*/\n \"Details\": [\n {\n \"Name\": \"Temperature\",\n \"Value\": String(temp)+\" °C\"\n }\n ],\n \"EmailMessageToSend\": {\n \"Subject\":\"Temperature Alert @ \"+String(topic),\n \"Body\":String(alertmessage)+\" \"+String(deviceid)\n },\n \"SMSMessageToSend\": \"string\",\n \"VoiceMessageToSend\": \"string\"\n};\n\nmsg.headers = {\n Accept: \"application/json\"\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":587,"y":105,"wires":[["609ce186.f8cf68"]]}]